import { useState, useEffect } from 'react';
import { dummyData } from '../data/dummyData';

function SettingsFormWidget({ currentUser }) {
  const [timeout, setTimeout] = useState(24);
  const [showModal, setShowModal] = useState(false);

  useEffect(() => {
    const settings = dummyData.settings.find((s) => s.tenantId === currentUser.tenantId);
    if (settings) setTimeout(settings.sessionTimeout / 3600000);
  }, [currentUser]);

  const handleSubmit = (e) => {
    e.preventDefault();
    dummyData.settings = dummyData.settings.map((s) =>
      s.tenantId === currentUser.tenantId
        ? {
            ...s,
            sessionTimeout: parseInt(timeout) * 3600000,
            updatedAt: new Date().toISOString(),
          }
        : s
    );
    setShowModal(false);
  };

  return (
    <div>
      <div id="content-header" className="bg-white p-4 border-b">
        <h2 className="text-lg font-semibold flex items-center">
          <svg className="h-6 w-6 fill-current mr-2" viewBox="0 0 24 24">
            <path d="M11.828 2.25c-.916 0-1.699.663-1.85 1.567l-.091.549a.798.798 0 0 1-.517.608 7.45 7.45 0 0 0-.478.198.798.798 0 0 1-.796-.064l-.453-.324a1.875 1.875 0 0 0-2.416.2l-.243.243a1.875 1.875 0 0 0-.2 2.416l.324.453a.798.798 0 0 1 .064.796 7.448 7.448 0 0 0-.198.478.798.798 0 0 1-.608.517l-.55.092a1.875 1.875 0 0 0-1.566 1.849v.344c0 .916.663 1.699 1.567 1.85l.549.091c.281.047.508.25.608.517.099.266.123.559.198.478a.798.798 0 0 1 .796.064l.453.324c.802.573 1.869.572 2.416-.2l.243-.243c.573-.802.572-1.869-.2-2.416l-.324-.453a.798.798 0 0 1-.064-.796c.075-.319.099-.612.198-.478a.798.798 0 0 1 .608-.517l.55-.092a1.875 1.875 0 0 0 1.566-1.849v-.344c0-.916-.663-1.699-1.567-1.85l-.549-.091a.798.798 0 0 1-.608-.517 7.507 7.507 0 0 0-.198-.478.798.798 0 0 1-.064-.796l.324-.453a1.875 1.875 0 0 0 .2-2.416l-.243-.243a1.875 1.875 0 0 0-2.416-.2l-.453.324a.798.798 0 0 1-.796.064 7.462 7.462 0 0 0-.478-.198.798.798 0 0 1-.517-.608l-.091-.549c-.15-.904-.934-1.567-1.85-1.567zm.172 2.828c.523 0 .972.378 1.057.894l.091.548c.099.595.573 1.068 1.168 1.167.294.049.58.123.854.22.523.187.784.717.624 1.208l-.324.453c-.336.47-.272 1.104.149 1.486.294.267.543.568.727.894.336.595.955.894 1.578.894h.344c.523 0 .972.378 1.057.894l.091.549c.099.595.573 1.068 1.168 1.167.294.049.58.123.854.22.523.187.784.717.624 1.208l-.324.453c-.336.47-.272 1.104.149 1.486.294.267.543.568.727.894.336.595.955.894 1.578.894h.344c.523 0 .972.378 1.057.894l.091.549c.099.595.573 1.068 1.168 1.167.294.049.58.123.854.22.523.187.784.717.624 1.208l-.324.453c-.336.47-.272 1.104.149 1.486.294.267.543.568.727.894.336.595.955.894 1.578.894h.344c.523 0 .972.378 1.057.894l.091.549c.099.595.573 1.068 1.168 1.167.294.049.58.123.854.22.523.187.784.717.624 1.208l-.324.453c-.336.47-.272 1.104.149 1.486.294.267.543.568.727.894.336.595.955.894 1.578.894h.344c.523 0 .972.378 1.057.894l.091.549c.15.904.934 1.567 1.85 1.567s1.699-.663 1.85-1.567l.091-.549c.099-.595.573-1.068 1.168-1.167.294-.049.58-.123.854-.22.523-.187.784-.717.624-1.208l-.324-.453c-.336-.47-.272-1.104.149-1.486.294-.267.543-.568.727-.894.336-.595.955-.894 1.578-.894h.344c.523 0 .972-.378 1.057-.894l.091-.549c.099-.595.573-1.068 1.168-1.167.294-.049.58-.123.854-.22.523-.187.784-.717.624-1.208l-.324-.453c-.336-.47-.272-1.104.149-1.486.294-.267.543-.568.727-.894.336-.595.955-.894 1.578-.894h.344c.523 0 .972-.378 1.057-.894l.091-.549c.099-.595.573-1.068 1.168-1.167.294-.049.58-.123.854-.22.523-.187.784-.717.624-1.208l-.324-.453c-.336-.47-.272-1.104.149-1.486.294-.267.543-.568.727-.894.336-.595.955-.894 1.578-.894h.344c.523 0 .972-.378 1.057-.894l.091-.549c.15-.904.934-1.567 1.85-1.567zm-7.828 1.172a4.125 4.125 0 1 1 0 8.25 4.125 4.125 0 0 1 0-8.25zm0 1.5a2.625 2.625 0 1 0 0 5.25 2.625 2.625 0 0 0 0-5.25z"/>
          </svg>
          Preferences
        </h2>
        <p className="text-gray-500 text-sm">Settings section</p>
      </div>
      <div id="content-body" className="flex-1 p-4 bg-white">
        <button
          onClick={() => setShowModal(true)}
          className="bg-sam-accent text-white px-4 py-2 rounded hover:bg-sam-primary flex items-center"
        >
          <svg className="h-5 w-5 fill-current mr-2" viewBox="0 0 24 24">
            <path d="M11.828 2.25c-.916 0-1.699.663-1.85 1.567l-.091.549a.798.798 0 0 1-.517.608 7.45 7.45 0 0 0-.478.198.798.798 0 0 1-.796-.064l-.453-.324a1.875 1.875 0 0 0-2.416.2l-.243.243a1.875 1.875 0 0 0-.2 2.416l.324.453a.798.798 0 0 1 .064.796 7.448 7.448 0 0 0-.198.478.798.798 0 0 1-.608.517l-.55.092a1.875 1.875 0 0 0-1.566 1.849v.344c0 .916.663 1.699 1.567 1.85l.549.091c.281.047.508.25.608.517.099.266.123.559.198.478a.798.798 0 0 1 .796.064l.453.324c.802.573 1.869.572 2.416-.2l.243-.243c.573-.802.572-1.869-.2-2.416l-.324-.453a.798.798 0 0 1-.064-.796c.075-.319.099-.612.198-.478a.798.798 0 0 1 .608-.517l.55-.092a1.875 1.875 0 0 0 1.566-1.849v-.344c0-.916-.663-1.699-1.567-1.85l-.549-.091a.798.798 0 0 1-.608-.517 7.507 7.507 0 0 0-.198-.478.798.798 0 0 1-.064-.796l.324-.453a1.875 1.875 0 0 0 .2-2.416l-.243-.243a1.875 1.875 0 0 0-2.416-.2l-.453.324a.798.798 0 0 1-.796.064 7.462 7.462 0 0 0-.478-.198.798.798 0 0 1-.517-.608l-.091-.549c-.15-.904-.934-1.567-1.85-1.567zm.172 2.828c.523 0 .972.378 1.057.894l.091.548c.099.595.573 1.068 1.168 1.167.294.049.58.123.854.22.523.187.784.717.624 1.208l-.324.453c-.336.47-.272 1.104.149 1.486.294.267.543.568.727.894.336.595.955.894 1.578.894h.344c.523 0 .972.378 1.057.894l.091.549c.099.595.573 1.068 1.168 1.167.294.049.58.123.854.22.523.187.784.717.624 1.208l-.324.453c-.336.47-.272 1.104.149 1.486.294.267.543.568.727.894.336.595.955.894 1.578.894h.344c.523 0 .972.378 1.057.894l.091.549c.099.595.573 1.068 1.168 1.167.294.049.58.123.854.22.523.187.784.717.624 1.208l-.324.453c-.336.47-.272 1.104.149 1.486.294.267.543.568.727.894.336.595.955.894 1.578.894h.344c.523 0 .972.378 1.057.894l.091.549c.099.595.573 1.068 1.168 1.167.294.049.58.123.854.22.523.187.784.717.624 1.208l-.324.453c-.336.47-.272 1.104.149 1.486.294.267.543.568.727.894.336.595.955.894 1.578.894h.344c.523 0 .972.378 1.057.894l.091.549c.15.904.934 1.567 1.85 1.567s1.699-.663 1.85-1.567l.091-.549c.099-.595.573-1.068 1.168-1.167.294-.049.58-.123.854-.22.523-.187.784-.717.624-1.208l-.324-.453c-.336-.47-.272-1.104.149-1.486.294-.267.543-.568.727-.894.336-.595.955-.894 1.578-.894h.344c.523 0 .972-.378 1.057-.894l.091-.549c.099-.595.573-1.068 1.168-1.167.294-.049.58-.123.854-.22.523-.187.784-.717.624-1.208l-.324-.453c-.336-.47-.272-1.104.149-1.486.294-.267.543-.568.727-.894.336-.595.955-.894 1.578-.894h.344c.523 0 .972-.378 1.057-.894l.091-.549c.099-.595.573-1.068 1.168-1.167.294-.049.58-.123.854-.22.523-.187.784-.717.624-1.208l-.324-.453c-.336-.47-.272-1.104.149-1.486.294-.267.543-.568.727-.894.336-.595.955-.894 1.578-.894h.344c.523 0 .972-.378 1.057-.894l.091-.549c.15-.904.934-1.567 1.85-1.567zm-7.828 1.172a4.125 4.125 0 1 1 0 8.25 4.125 4.125 0 0 1 0-8.25zm0 1.5a2.625 2.625 0 1 0 0 5.25 2.625 2.625 0 0 0 0-5.25z"/>
          </svg>
          Edit Session Timeout
        </button>
        {showModal && (
          <div className="modal" style={{ display: 'flex' }}>
            <div className="modal-content">
              <h2 className="text-xl font-bold mb-4">Edit Settings</h2>
              <div>
                <div className="mb-4">
                  <label className="block text-sm font-medium mb-1">Session Timeout (hours)</label>
                  <input
                    type="number"
                    min="1"
                    value={timeout}
                    onChange={(e) => setTimeout(e.target.value)}
                    className="w-full p-2 border rounded focus:outline-none focus:ring-2 ring-sam-accent"
                    required
                  />
                </div>
                <div className="flex justify-end space-x-2">
                  <button
                    type="button"
                    onClick={() => setShowModal(false)}
                    className="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400"
                  >
                    Cancel
                  </button>
                  <button
                    type="submit"
                    onClick={handleSubmit}
                    className="px-4 py-2 bg-sam-accent text-white rounded hover:bg-sam-primary"
                  >
                    Save
                  </button>
                </div>
              </div>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}

export default SettingsFormWidget;